package mpt

import (
	"encoding/json"
	"testing"

	"github.com/joeqian10/neo-gogogo/helper"
	"github.com/joeqian10/neo-gogogo/helper/io"
)

func TestStateRootSerialize(t *testing.T) {
	var sr StateRoot
	data := []byte(`{"version":0,"index":19571,"prehash":"0xf4e4a59b1c89dd3343f18d47bb12429b04cb5d179af680e8337240cd2f427de0","stateroot":"0x34db5a993a95e0db79efe8220bf142e5952056bb59834fe3b91fc1611ed4385e","witness":{"invocation":"400f3dd87f541e56d47c5807ee6bfa16d667c22c00038a14d816d86c1f69a6ff54b41dd7d3a27070c1ac9631842ab775ec3d39ac711233d7a89601e75b8db0837040b176cdaf030b02ca80a85fe6f5595be23b81b103468b572917e60dd4e4c4cf2c35b5bcb9649fb984f95977f7fbbb799ee5920f806371458ad8740e0fe6c907fd408a9fc8cdc5bb6dfa03a8cc77e66a270cf9658ca9ae542afe74ceee39432d1da3fcde0cf316dd2fdb0bea9f1d8519bdedc56c031e8ce38b7cfd33d45ef32b083b","verification":"53210244d12fa1b7a9a2cd3c15c4f2058154510dbc4ec42aba2dca216be68f1689c3f3210394f30f5a77ee3096a66ebaf58b97db17b9b51c692bda171a6e459de67c118d7a210397b563c76bcf493939e234caf40bca1ac9e2edd29973dccdd11def8713e708ec2102f257d51b7966eb2b11cd4d8644bc55dd7a39293f9c027a3cede5ae0289c2e8e354ae"}}`)
	err := json.Unmarshal(data, &sr)
	if err != nil {
		t.Error(err)
	}
	data, _ = io.ToArray(&sr)
	if helper.BytesToHex(data) != "00000000734c0000e07d422fcd407233e880f69a175dcb049b4212bb478df14333dd891c9ba5e4f45e38d41e61c11fb9e34f8359bb562095e542f10b22e8ef79dbe0953a995adb3401c3400f3dd87f541e56d47c5807ee6bfa16d667c22c00038a14d816d86c1f69a6ff54b41dd7d3a27070c1ac9631842ab775ec3d39ac711233d7a89601e75b8db0837040b176cdaf030b02ca80a85fe6f5595be23b81b103468b572917e60dd4e4c4cf2c35b5bcb9649fb984f95977f7fbbb799ee5920f806371458ad8740e0fe6c907fd408a9fc8cdc5bb6dfa03a8cc77e66a270cf9658ca9ae542afe74ceee39432d1da3fcde0cf316dd2fdb0bea9f1d8519bdedc56c031e8ce38b7cfd33d45ef32b083b8b53210244d12fa1b7a9a2cd3c15c4f2058154510dbc4ec42aba2dca216be68f1689c3f3210394f30f5a77ee3096a66ebaf58b97db17b9b51c692bda171a6e459de67c118d7a210397b563c76bcf493939e234caf40bca1ac9e2edd29973dccdd11def8713e708ec2102f257d51b7966eb2b11cd4d8644bc55dd7a39293f9c027a3cede5ae0289c2e8e354ae" {
		t.Error("serialize failed")
	}
	io.AsSerializable(&sr, data)
	data, _ = io.ToArray(&sr)
	if helper.BytesToHex(data) != "00000000734c0000e07d422fcd407233e880f69a175dcb049b4212bb478df14333dd891c9ba5e4f45e38d41e61c11fb9e34f8359bb562095e542f10b22e8ef79dbe0953a995adb3401c3400f3dd87f541e56d47c5807ee6bfa16d667c22c00038a14d816d86c1f69a6ff54b41dd7d3a27070c1ac9631842ab775ec3d39ac711233d7a89601e75b8db0837040b176cdaf030b02ca80a85fe6f5595be23b81b103468b572917e60dd4e4c4cf2c35b5bcb9649fb984f95977f7fbbb799ee5920f806371458ad8740e0fe6c907fd408a9fc8cdc5bb6dfa03a8cc77e66a270cf9658ca9ae542afe74ceee39432d1da3fcde0cf316dd2fdb0bea9f1d8519bdedc56c031e8ce38b7cfd33d45ef32b083b8b53210244d12fa1b7a9a2cd3c15c4f2058154510dbc4ec42aba2dca216be68f1689c3f3210394f30f5a77ee3096a66ebaf58b97db17b9b51c692bda171a6e459de67c118d7a210397b563c76bcf493939e234caf40bca1ac9e2edd29973dccdd11def8713e708ec2102f257d51b7966eb2b11cd4d8644bc55dd7a39293f9c027a3cede5ae0289c2e8e354ae" {
		t.Error("serialize failed")
	}
}
